syntax = "proto3";

// Image processing plugin with SIMD optimizations

enum ColorSpace {
    RGB = 0;
    RGBA = 1;
    GRAYSCALE = 2;
    YUV = 3;
    HSV = 4;
}

enum FilterType {
    BLUR = 0;
    SHARPEN = 1;
    EDGE_DETECT = 2;
    EMBOSS = 3;
    GAUSSIAN = 4;
}

enum InterpolationMode {
    NEAREST = 0;
    BILINEAR = 1;
    BICUBIC = 2;
}

// Core pixel data structure - SIMD optimized
message Pixel {
    option (proto2ffi.simd) = true;

    uint32 r = 1;
    uint32 g = 2;
    uint32 b = 3;
    uint32 a = 4;
}

// Floating point pixel for high precision operations
message PixelF32 {
    option (proto2ffi.simd) = true;

    float r = 1;
    float g = 2;
    float b = 3;
    float a = 4;
}

// Image metadata
message ImageInfo {
    uint32 width = 1;
    uint32 height = 2;
    ColorSpace color_space = 3;
    uint32 channels = 4;
    uint32 bit_depth = 5;
}

// Image buffer - large pool for image data
message ImageBuffer {
    option (proto2ffi.pool_size) = 10000;

    uint32 width = 1;
    uint32 height = 2;
    uint32 stride = 3;
    ColorSpace color_space = 4;
    repeated uint32 data = 5 [(proto2ffi.max_count) = 16777216]; // 4K RGBA: 3840*2160*4 = 33M, using 16M for safety
}

// Small kernel for convolution operations
message ConvolutionKernel {
    option (proto2ffi.pool_size) = 1000;

    uint32 size = 1;
    repeated float weights = 2 [(proto2ffi.max_count) = 25]; // 5x5 kernel max
    float divisor = 3;
    float bias = 4;
}

// Rectangle for region of interest
message Rect {
    option (proto2ffi.simd) = true;

    uint32 x = 1;
    uint32 y = 2;
    uint32 width = 3;
    uint32 height = 4;
}

// Transform matrix for affine transformations
message Transform2D {
    option (proto2ffi.simd) = true;

    float m11 = 1;
    float m12 = 2;
    float m13 = 3;
    float m21 = 4;
    float m22 = 5;
    float m23 = 6;
}

// Histogram for image analysis
message Histogram {
    option (proto2ffi.simd) = true;

    repeated uint32 bins = 1 [(proto2ffi.max_count) = 256];
}

// Color statistics
message ColorStats {
    option (proto2ffi.simd) = true;

    float mean_r = 1;
    float mean_g = 2;
    float mean_b = 3;
    float stddev_r = 4;
    float stddev_g = 5;
    float stddev_b = 6;
    uint32 min_r = 7;
    uint32 min_g = 8;
    uint32 min_b = 9;
    uint32 max_r = 10;
    uint32 max_g = 11;
    uint32 max_b = 12;
}

// Processing result with timing info
message ProcessingResult {
    bool success = 1;
    uint64 processing_time_ns = 2;
    uint32 pixels_processed = 3;
    string error_message = 4 [(proto2ffi.max_length) = 256];
}

// Batch processing metadata
message BatchInfo {
    option (proto2ffi.simd) = true;

    uint32 total_images = 1;
    uint32 processed = 2;
    uint32 failed = 3;
    uint64 total_time_ns = 4;
}

// Filter parameters
message FilterParams {
    FilterType filter_type = 1;
    float strength = 2;
    float radius = 3;
    float threshold = 4;
}

// Resize parameters
message ResizeParams {
    uint32 new_width = 1;
    uint32 new_height = 2;
    InterpolationMode interpolation = 3;
    bool preserve_aspect = 4;
}

// Color adjustment parameters
message ColorAdjustment {
    option (proto2ffi.simd) = true;

    float brightness = 1;
    float contrast = 2;
    float saturation = 3;
    float hue_shift = 4;
    float gamma = 5;
}

// Performance metrics
message PerformanceMetrics {
    option (proto2ffi.simd) = true;

    uint64 total_pixels_processed = 1;
    uint64 total_time_ns = 2;
    double megapixels_per_second = 3;
    uint32 cache_hits = 4;
    uint32 cache_misses = 5;
    uint32 simd_operations = 6;
    uint32 scalar_operations = 7;
}

// Temporary workspace for image operations
message ImageWorkspace {
    option (proto2ffi.pool_size) = 100;

    repeated float temp_buffer = 1 [(proto2ffi.max_count) = 16777216];
    uint32 buffer_size = 2;
}
