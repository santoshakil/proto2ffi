// Generated by proto2ffi
// DO NOT EDIT

import 'dart:ffi' as ffi;
import 'package:ffi/ffi.dart';

import 'byte_buffer.dart';

/// Greeter service client
///
/// This client provides a clean Dart API for calling the Rust service
/// via FFI with protobuf encoding.
class GreeterClient {
  final ffi.DynamicLibrary _dylib;
  late final _say_hello;
  late final FreeByteBufferDart _freeByteBuffer;

  GreeterClient(this._dylib) {
    _say_hello = _dylib.lookupFunction<
      ByteBuffer Function(ffi.Pointer<ffi.Uint8>, ffi.Size),
      ByteBuffer Function(ffi.Pointer<ffi.Uint8>, int)
    >('proto2ffi_say_hello');

    _freeByteBuffer = _dylib.lookupFunction<
      FreeByteBufferNative,
      FreeByteBufferDart
    >('proto2ffi_free_byte_buffer');
  }

  /// Call the SayHello RPC method
  ///
  /// Takes a HelloRequest protobuf message and returns a HelloResponse protobuf message.
  /// Returns null if the call fails.
  List<int>? say_hello(List<int> requestBytes) {
    final requestPtr = malloc.allocate<ffi.Uint8>(requestBytes.length);
    requestPtr.asTypedList(requestBytes.length).setAll(0, requestBytes);

    final result = _say_hello(requestPtr, requestBytes.length);
    malloc.free(requestPtr);

    if (result.ptr == ffi.nullptr) {
      return null;
    }

    final responseBytes = result.toUint8List();
    _freeByteBuffer(result);

    return responseBytes;
  }

}
